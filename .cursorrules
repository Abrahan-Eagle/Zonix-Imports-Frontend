rules:
  - type: project
    value: |
      Proyecto: MVP de e-commerce multi-modal (Frontend Flutter) alineado con el Backend Laravel 10.
      VisiÃ³n: CatÃ¡logo pÃºblico, carrito, checkout, pagos (API y manuales), gestiÃ³n de productos del vendedor y pedidos.

      Roles principales (UI):
      - Visitante: catÃ¡logo pÃºblico (solo lectura)
      - Comprador: login con Google, carrito, checkout, pedidos, notificaciones
      - Vendedor: publicaciÃ³n de productos, inventario bÃ¡sico, gestiÃ³n de pedidos
      - Admin (mÃ­nimo): vistas bÃ¡sicas (puede resolverse en backend web)

  - type: architecture
    value: |
      Estructura de Directorios (Clean Architecture + Feature-First):
      
      lib/
      â”œâ”€â”€ core/                       # âœ… NÃºcleo de la aplicaciÃ³n
      â”‚   â”œâ”€â”€ config/                # âœ… ConfiguraciÃ³n global
      â”‚   â”‚   â”œâ”€â”€ app_config.dart    # âœ… URLs, constantes
      â”‚   â”‚   â”œâ”€â”€ theme.dart         # âœ… Tema y colores
      â”‚   â”‚   â””â”€â”€ routes.dart        # âœ… Rutas de navegaciÃ³n
      â”‚   â”œâ”€â”€ constants/             # âœ… Constantes globales
      â”‚   â”‚   â”œâ”€â”€ app_constants.dart # âœ… Constantes de app
      â”‚   â”‚   â”œâ”€â”€ api_constants.dart # âœ… Constantes de API
      â”‚   â”‚   â””â”€â”€ ui_constants.dart  # âœ… Constantes de UI
      â”‚   â”œâ”€â”€ utils/                 # âœ… Utilidades globales
      â”‚   â”‚   â”œâ”€â”€ validators.dart    # âœ… Validaciones
      â”‚   â”‚   â”œâ”€â”€ formatters.dart    # âœ… Formateo de datos
      â”‚   â”‚   â”œâ”€â”€ helpers.dart       # âœ… Helpers generales
      â”‚   â”‚   â””â”€â”€ extensions.dart    # âœ… Extensiones de Dart
      â”‚   â””â”€â”€ services/              # âœ… Servicios base
      â”‚       â”œâ”€â”€ api_service.dart   # âœ… Cliente HTTP base
      â”‚       â”œâ”€â”€ storage_service.dart # âœ… Servicio de almacenamiento
      â”‚       â””â”€â”€ notification_service.dart # âœ… Notificaciones
      â”‚
      â”œâ”€â”€ shared/                     # âœ… Componentes compartidos
      â”‚   â”œâ”€â”€ widgets/               # âœ… Widgets comunes
      â”‚   â”‚   â”œâ”€â”€ buttons/           # âœ… Botones reutilizables
      â”‚   â”‚   â”œâ”€â”€ inputs/            # âœ… Campos de entrada
      â”‚   â”‚   â”œâ”€â”€ cards/             # âœ… Tarjetas
      â”‚   â”‚   â”œâ”€â”€ dialogs/           # âœ… DiÃ¡logos y modales
      â”‚   â”‚   â”œâ”€â”€ loaders/           # âœ… Indicadores de carga
      â”‚   â”‚   â””â”€â”€ app_bar/           # âœ… AppBars personalizados
      â”‚   â”œâ”€â”€ models/                # âœ… Modelos base
      â”‚   â”‚   â”œâ”€â”€ base_model.dart    # âœ… Modelo base
      â”‚   â”‚   â”œâ”€â”€ api_response.dart  # âœ… Respuesta de API
      â”‚   â”‚   â””â”€â”€ pagination.dart    # âœ… PaginaciÃ³n
      â”‚   â””â”€â”€ providers/             # âœ… Providers compartidos
      â”‚       â”œâ”€â”€ theme_provider.dart # âœ… Provider de tema
      â”‚       â””â”€â”€ app_state_provider.dart # âœ… Estado global
      â”‚
      â”œâ”€â”€ features/                   # âœ… MÃ³dulos por funcionalidad
      â”‚   â”œâ”€â”€ auth/                  # âœ… MÃ³dulo autenticaciÃ³n
      â”‚   â”‚   â”œâ”€â”€ data/              # âœ… Capa de datos
      â”‚   â”‚   â”‚   â”œâ”€â”€ models/        # âœ… User, Profile, etc.
      â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/  # âœ… AuthRepository
      â”‚   â”‚   â”‚   â””â”€â”€ datasources/   # âœ… AuthApiService
      â”‚   â”‚   â”œâ”€â”€ domain/            # âœ… LÃ³gica de negocio
      â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # âœ… Entidades de dominio
      â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/  # âœ… Interfaces de repositorio
      â”‚   â”‚   â”‚   â””â”€â”€ usecases/      # âœ… Casos de uso
      â”‚   â”‚   â”œâ”€â”€ presentation/      # âœ… Capa de presentaciÃ³n
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… AuthProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… LoginForm, etc.
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… LoginPage, etc.
      â”‚   â”‚   â””â”€â”€ auth_module.dart   # âœ… MÃ³dulo de inyecciÃ³n
      â”‚   â”‚
      â”‚   â”œâ”€â”€ products/              # âœ… MÃ³dulo productos
      â”‚   â”‚   â”œâ”€â”€ data/
      â”‚   â”‚   â”‚   â”œâ”€â”€ models/        # âœ… Product, Category, etc.
      â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/  # âœ… ProductRepository
      â”‚   â”‚   â”‚   â””â”€â”€ datasources/   # âœ… ProductApiService
      â”‚   â”‚   â”œâ”€â”€ domain/
      â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # âœ… Entidades de producto
      â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/  # âœ… Interfaces
      â”‚   â”‚   â”‚   â””â”€â”€ usecases/      # âœ… GetProducts, CreateProduct, etc.
      â”‚   â”‚   â”œâ”€â”€ presentation/
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… ProductProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… ProductCard, etc.
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… ProductsPage, etc.
      â”‚   â”‚   â””â”€â”€ products_module.dart
      â”‚   â”‚
      â”‚   â”œâ”€â”€ cart/                  # âœ… MÃ³dulo carrito
      â”‚   â”‚   â”œâ”€â”€ data/models/       # âœ… CartItem, Cart
      â”‚   â”‚   â”œâ”€â”€ domain/usecases/   # âœ… AddToCart, RemoveFromCart
      â”‚   â”‚   â”œâ”€â”€ presentation/
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… CartProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… CartItemWidget
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… CartPage
      â”‚   â”‚   â””â”€â”€ cart_module.dart
      â”‚   â”‚
      â”‚   â”œâ”€â”€ orders/                # âœ… MÃ³dulo Ã³rdenes
      â”‚   â”‚   â”œâ”€â”€ data/models/       # âœ… Order, OrderItem
      â”‚   â”‚   â”œâ”€â”€ domain/usecases/   # âœ… CreateOrder, GetOrders
      â”‚   â”‚   â”œâ”€â”€ presentation/
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… OrderProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… OrderCard
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… OrdersPage, OrderDetailPage
      â”‚   â”‚   â””â”€â”€ orders_module.dart
      â”‚   â”‚
      â”‚   â”œâ”€â”€ commerce/              # âœ… MÃ³dulo comercio (vendedor)
      â”‚   â”‚   â”œâ”€â”€ data/models/       # âœ… Seller, Commerce
      â”‚   â”‚   â”œâ”€â”€ domain/usecases/   # âœ… ManageProducts, ViewSales
      â”‚   â”‚   â”œâ”€â”€ presentation/
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… CommerceProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… ProductForm
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… CommerceDashboard
      â”‚   â”‚   â””â”€â”€ commerce_module.dart
      â”‚   â”‚
      â”‚   â”œâ”€â”€ payments/              # âœ… MÃ³dulo pagos
      â”‚   â”‚   â”œâ”€â”€ data/models/       # âœ… Payment, PaymentMethod
      â”‚   â”‚   â”œâ”€â”€ domain/usecases/   # âœ… ProcessPayment
      â”‚   â”‚   â”œâ”€â”€ presentation/
      â”‚   â”‚   â”‚   â”œâ”€â”€ providers/     # âœ… PaymentProvider
      â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/       # âœ… PaymentForm
      â”‚   â”‚   â”‚   â””â”€â”€ screens/       # âœ… PaymentPage
      â”‚   â”‚   â””â”€â”€ payments_module.dart
      â”‚   â”‚
      â”‚   â””â”€â”€ profile/               # âœ… MÃ³dulo perfil
      â”‚       â”œâ”€â”€ data/models/       # âœ… Profile, Address, Document
      â”‚       â”œâ”€â”€ domain/usecases/   # âœ… UpdateProfile, ManageAddresses
      â”‚       â”œâ”€â”€ presentation/
      â”‚       â”‚   â”œâ”€â”€ providers/     # âœ… ProfileProvider
      â”‚       â”‚   â”œâ”€â”€ widgets/       # âœ… ProfileForm
      â”‚       â”‚   â””â”€â”€ screens/       # âœ… ProfilePage, SettingsPage
      â”‚       â””â”€â”€ profile_module.dart
      â”‚
      â”œâ”€â”€ app/                       # âœ… ConfiguraciÃ³n de la app
      â”‚   â”œâ”€â”€ app.dart              # âœ… Widget principal
      â”‚   â”œâ”€â”€ app_module.dart       # âœ… InyecciÃ³n de dependencias
      â”‚   â””â”€â”€ app_routes.dart       # âœ… ConfiguraciÃ³n de rutas
      â”‚
      â””â”€â”€ main.dart                 # âœ… Punto de entrada

  - type: coding
    value: |
      EstÃ¡ndares y convenciones (Frontend Flutter):
      - Flutter/Dart 3.x. Respetar analysis_options.yaml
      - Arquitectura: Clean Architecture + Feature-First + Provider
      - PatrÃ³n: Repository + UseCase + Provider
      - CÃ³digo: nombres descriptivos, evitar abreviaturas, manejo explÃ­cito de errores
      - UI: componentes reutilizables; loading y error states consistentes
      - Estado: Provider centralizado por feature; no lÃ³gica de negocio en widgets puros
      - Red: timeouts razonables, reintentos bÃ¡sicos, headers `{ Authorization: Bearer <token> }`
      - Seguridad: tokens en flutter_secure_storage; sin logs de PII/tokens
      - InternacionalizaciÃ³n: preparada (post-MVP si no estÃ¡)
      
      Convenciones de nomenclatura:
      - Archivos: snake_case (user_profile_page.dart)
      - Clases: PascalCase (UserProfilePage)
      - Variables: camelCase (userName)
      - Constantes: UPPER_SNAKE_CASE (API_BASE_URL)
      - Providers: [Feature]Provider (AuthProvider, CartProvider)
      - Models: [Entity]Model (UserModel, ProductModel)
      - Services: [Feature]Service (AuthService, ProductService)

  - type: api_contract
    value: |
      Endpoints mÃ­nimos consumidos (prefijo /api del backend):
      - Auth:
        - POST /auth/google
        - GET /me
        - PUT /me/role
      - Productos/CatÃ¡logo:
        - GET /products?filters...
        - CRUD /products (vendedor)
        - POST /products/{id}/images
      - Carrito/Checkout:
        - POST /cart, GET /cart, PUT /cart/{item}, DELETE /cart/{item}
        - POST /checkout
      - Pagos:
        - GET /payments/methods
        - POST /payments/stripe|paypal|binance
        - POST /payments/comprobante
        - POST /webhooks/{provider}
      - Pedidos/Tracking:
        - GET /orders
        - GET /seller/orders
        - PUT /seller/orders/{id}/status
        - GET /orders/{id}/tracking
      - Notificaciones:
        - GET /notifications
        - PUT /notifications/{id}/read

      Contrato:
      - AutenticaciÃ³n: Authorization: Bearer <token> (Sanctum)
      - PaginaciÃ³n: ?page=N&per_page=M â†’ { data, meta: { current_page, per_page, total } }
      - Errores: { message, errors?, code }
      - Fechas: ISO 8601 (UTC)

  - type: tasks
    value: |
      MVP Frontend (alineado):
      - Auth Google + perfil bÃ¡sico
      - CatÃ¡logo con modalidades (detal, mayor, pre-order, referidos, dropshipping)
      - Carrito + Checkout
      - Pagos (API y manuales)
      - Pedidos (lista/detalle/seguimiento)
      - Notificaciones (lista + marcar leÃ­das)
      - MÃ³dulo vendedor mÃ­nimo (CRUD productos + inventario bÃ¡sico)

  - type: contribution
    value: |
      ContribuciÃ³n:
      - Commits convencionales (feat, fix, refactor, docs, chore)
      - PRs pequeÃ±as con checklist; ejecutar `flutter test`
      - No exponer secretos; variables en config/env

  - type: integration
    value: |
      IntegraciÃ³n con Backend:
      - `API_BASE_URL` apuntando a `/api`
      - CORS habilitado en backend para la app
      - Tokens: guardar/renovar; cerrar sesiÃ³n limpia
      - Manejo de errores unificado y mapeo de `errors` a formularios

  - type: patterns
    value: |
      Patrones de Desarrollo Recomendados:
      
      ğŸ“ Estructura por Feature:
      - Cada feature es un mÃ³dulo independiente
      - Capas separadas: data/domain/presentation
      - InyecciÃ³n de dependencias por mÃ³dulo
      
      ğŸ”„ Provider Pattern:
      - Un Provider por feature principal
      - Estados: loading, success, error
      - MÃ©todos: async/await con try-catch
      - NotifyListeners() para actualizar UI
      
      ğŸ—ï¸ Repository Pattern:
      - Interface en domain/repositories/
      - ImplementaciÃ³n en data/repositories/
      - Abstrae fuentes de datos (API, Local)
      
      ğŸ¯ UseCase Pattern:
      - Un UseCase por acciÃ³n de negocio
      - LÃ³gica de negocio centralizada
      - FÃ¡cil testing y mantenimiento
      
      ğŸ“± Widget Composition:
      - Widgets pequeÃ±os y reutilizables
      - SeparaciÃ³n de lÃ³gica y presentaciÃ³n
      - Custom widgets en shared/widgets/
      
      ğŸ¨ UI/UX Guidelines:
      - Material Design 3
      - Responsive design (mÃ³vil/tablet)
      - Loading states consistentes
      - Error handling con snackbars
      - NavegaciÃ³n fluida con transiciones
      
      ğŸ§ª Testing Strategy:
      - Unit tests para UseCases
      - Widget tests para componentes
      - Integration tests para flujos completos
      - Mock de dependencias externas
      
      ğŸ“Š State Management:
      - Provider para estado local
      - SharedPreferences para persistencia
      - flutter_secure_storage para tokens
      - Cache inteligente con TTL
      
      ğŸ”’ Security Best Practices:
      - ValidaciÃ³n de inputs en frontend
      - SanitizaciÃ³n de datos
      - Tokens seguros (no en logs)
      - Certificados SSL en producciÃ³n

  - type: development_workflow
    value: |
      Flujo de Desarrollo:
      
      1. ğŸ¯ PlanificaciÃ³n:
         - Definir feature en GitHub Issues
         - Crear branch desde main
         - Seguir estructura de directorios
      
      2. ğŸ—ï¸ Desarrollo:
         - Crear modelos de datos primero
         - Implementar repositorios y UseCases
         - Desarrollar Providers
         - Crear widgets y pantallas
         - Escribir tests
      
      3. ğŸ§ª Testing:
         - Unit tests: flutter test
         - Widget tests: flutter test
         - Integration tests: flutter drive
         - Coverage: flutter test --coverage
      
      4. ğŸ“± Build & Deploy:
         - Debug: flutter run -d <device_ip>:5555
         - Release: flutter build apk --release
         - Testing en dispositivo fÃ­sico
      
      5. ğŸ”„ Code Review:
         - Pull Request con descripciÃ³n clara
         - Checklist de revisiÃ³n
         - Approval de al menos 1 reviewer
         - Merge a main despuÃ©s de approval
      
      6. ğŸ“¦ Release:
         - Tag de versiÃ³n semÃ¡ntica
         - Changelog actualizado
         - Deploy a producciÃ³n
      
      ğŸ“‹ Checklist de PR:
      - [ ] CÃ³digo sigue convenciones de nomenclatura
      - [ ] Tests pasan (flutter test)
      - [ ] No hay warnings de linter
      - [ ] Funcionalidad probada en dispositivo
      - [ ] DocumentaciÃ³n actualizada si es necesario
      - [ ] Performance optimizada
      - [ ] Memory leaks revisados
      - [ ] Responsive design verificado
      - [ ] Error handling implementado
      - [ ] Loading states incluidos
